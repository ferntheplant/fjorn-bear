<script>
  document.addEventListener("DOMContentLoaded", main);
  function addSubscribeText() {
    if (window.location.pathname !== '/blog/') {
      return
    }
    // Select the ul element with class "blog-posts"
    var ulElement = document.querySelector("main ul.blog-posts");

    // Create a new paragraph element
    var paragraph = document.createElement("p");

    var htmlContent = `You don&#39;t have to subscribe by <a href="/subscribe/">email</a> or <a href="/feed/">RSS</a>, but it&#39;d be a lot cooler if you did.`

    // Set HTML content of the paragraph
    paragraph.innerHTML = htmlContent;

    // Add inline CSS styling
    paragraph.style.marginTop = "0";

    if (ulElement) {
      ulElement.parentNode.insertBefore(paragraph, ulElement);
    } else {
      console.error("The ul element with class 'blog-posts' within <main> was not found.");
    }
  }

  function highlightNavAndSetTimes() {
    // active selected page in nav
    var navLinks = document.querySelectorAll('nav a');

    var currentSlug = window.location.pathname;

    let setActive = false
    let blogLink = null
    navLinks.forEach(function (link) {
      // Check if the href matches the current slug
      if (link.getAttribute('href') === currentSlug) {
        link.classList.add('active');
        setActive = true
      }
      if (link.getAttribute('href') === '/blog/') {
        blogLink = link
      }
    });
    if (!setActive && blogLink) {
      blogLink.classList.add('active')
    }

    // nicely formatted times in lists
    var timeTags = document.querySelectorAll('time');

    timeTags.forEach(function (timeTag) {
      var datetime = timeTag.getAttribute('datetime');
      var date = new Date(datetime);
      var formattedDate = formatDate(date);
      timeTag.innerHTML = formattedDate;
    });

    function formatDate(date) {
      var options = { year: 'numeric', month: 'short', day: '2-digit' };
      return date.toLocaleDateString('en-US', options);
    }
  };
  function clickableHeadings() {
    var headings = document.querySelectorAll('h2, h3, h4, h5, h6');
    headings.forEach((heading) => {
      heading.addEventListener('click', () => {
        let url = window.location.pathname;
        url += `#${heading.getAttribute('id')}`
        history.pushState({}, '', url)
      })
    })
  }
  function main() {
    addSubscribeText()
    highlightNavAndSetTimes()
    clickableHeadings()
  }
</script>